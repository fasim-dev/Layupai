<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <title>LayUp AI - Pakar Ayam Petelur</title>
    
    <!-- Load resources -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    
    <!-- Load external CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- Sidebar Backdrop -->
        <div class="sidebar-backdrop" id="sidebarBackdrop"></div>

        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="side-head">LayUp AI - Pakar Layer</div>
            <div class="side-list">
                <div class="group-title">Fitur Khusus</div>
                <div class="item special" id="healthDiagnosis">
                    <div class="icon"><i class="fa-solid fa-stethoscope"></i></div>
                    <div class="name">Diagnosis Kesehatan</div>
                </div>
                <div class="item special" id="feedCalculator">
                    <div class="icon"><i class="fa-solid fa-calculator"></i></div>
                    <div class="name">Kalkulator Pakan</div>
                </div>
                <div class="item special" id="productionTracker">
                    <div class="icon"><i class="fa-solid fa-chart-line"></i></div>
                    <div class="name">Pelacak Produksi</div>
                </div>
                <div class="item special" id="diseaseEncyclopedia">
                    <div class="icon"><i class="fa-solid fa-book-medical"></i></div>
                    <div class="name">Ensiklopedia Penyakit</div>
                </div>
                
                <div class="group-title">Riwayat Chat</div>
                <div id="historyActive"></div>
                <div class="group-title" style="margin-top:14px">Arsip</div>
                <div id="historyArchive"></div>
            </div>
            <div class="side-foot">
                <div class="account" id="accountBtn">
                    <div class="avatar">ðŸ§‘</div>
                    <div style="flex:1">
                        <div style="font-weight:600">Akun Peternak</div>
                        <div style="color:var(--muted);font-size:12px">free plan</div>
                    </div>
                    <i class="fa-solid fa-chevron-up"></i>
                </div>
            </div>
        </aside>

        <!-- ACCOUNT MENU -->
        <div class="account-menu" id="accountMenu">
            <div class="row" id="apiKeyBtn"><i class="fa-solid fa-key"></i> Pengaturan API</div>
            <div class="row" id="accProfile"><i class="fa-regular fa-user"></i> Profil</div>
            <div class="row" id="accSettings"><i class="fa-solid fa-gear"></i> Pengaturan</div>
            <div class="row" id="accLogout"><i class="fa-solid fa-right-from-bracket"></i> Keluar</div>
        </div>

        <!-- MAIN -->
        <main class="main" id="mainArea">
            <!-- Header -->
            <header class="topbar">
                <div class="left">
                    <button class="toggler" id="sideToggle" title="Buka/tutup sidebar"><i class="fa-solid fa-bars"></i></button>
                    <div class="brand"><div class="logo" aria-hidden="true"></div><div class="title">LayUp AI</div></div>
                </div>
                <div class="actions">
                    <button class="btn icon-only" id="newChatBtn" title="Chat baru"><i class="fa-solid fa-plus"></i><span class="label">New Chat</span></button>
                    <button class="btn icon-only" id="moreBtn" title="Menu"><i class="fa-solid fa-ellipsis-vertical"></i><span class="label">More</span></button>
                    <!-- Dropdown â‹® -->
                    <div class="menu" id="moreMenu" role="menu" aria-hidden="true">
                        <div class="item" id="addQna"><i class="fa-solid fa-square-plus"></i><span>Tambah QnA</span></div>
                        <div class="item" id="exportChat"><i class="fa-solid fa-file-export"></i><span>Export Chat</span></div>
                        <div class="item" id="importChat"><i class="fa-solid fa-file-import"></i><span>Import Chat</span></div>
                        <div class="item" id="apiToggleItem">
                            <i class="fa-solid fa-plug"></i>
                            <span>DeepSeek API</span>
                            <label class="switch">
                                <input type="checkbox" id="apiToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Chat stream -->
            <section class="stream" id="stream" aria-live="polite"></section>

            <!-- Composer -->
            <footer class="dock">
                <div class="compose-wrap">
                    <div class="compose">
                        <!-- Left icons -->
                        <div class="icon-left">
                            <button class="icon-btn" id="micBtn" title="Suara (mic)"><i class="fa-solid fa-microphone"></i></button>
                            <button class="icon-btn" id="attachBtn" title="Lampiran"><i class="fa-solid fa-plus"></i></button>
                        </div>
                        <div class="textbox"><textarea id="input" placeholder="yuk tanya tentang ayam petelurâ€¦"></textarea></div>
                        <div class="icon-right">
                            <button class="icon-btn" id="expandBtn" title="Perbesar"><i class="fa-solid fa-up-right-and-down-left-from-center"></i></button>
                            <button class="send" id="sendBtn" title="Kirim"><i class="fa-solid fa-paper-plane"></i></button>
                        </div>

                        <!-- Attach submenu -->
                        <div class="attach-menu" id="attachMenu">
                            <div class="row" id="attachCamera"><i class="fa-solid fa-camera"></i> Kamera</div>
                            <div class="row" id="attachPhoto"><i class="fa-solid fa-image"></i> Foto</div>
                            <div class="row" id="attachFile"><i class="fa-solid fa-file-arrow-up"></i> File</div>
                        </div>
<!-- File inputs -->
<input type="file" id="fileInput" style="display:none"/>
<input type="file" id="camInput" accept="image/*" capture="environment" style="display:none"/>
<input type="file" id="photoInput" accept="image/*" style="display:none"/>
<input type="file" id="importFile" accept="application/json" style="display:none"/>

<!-- Fullscreen Composer -->
<div class="overlay" id="overlay">
    <!-- ... -->
</div>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- File inputs -->
    <input type="file" id="fileInput" style="display:none"/>
    <input type="file" id="camInput" accept="image/*" capture="environment" style="display:none"/>
    <input type="file" id="photoInput" accept="image/*" style="display:none"/>
    <input type="file" id="importFile" accept="application/json" style="display:none"/>

    <!-- Fullscreen Composer -->
    <div class="overlay" id="overlay">
        <div class="panel">
            <div style="display:flex;align-items:center;justify-content:space-between">
                <div style="font-weight:700">Compose</div>
                <button class="ghost" id="closeOverlay"><i class="fa-solid fa-compress"></i> Tutup</button>
            </div>
            <textarea id="overlayInput" placeholder="Tulis pertanyaan di siniâ€¦"></textarea>
            <div class="row">
                <button class="ghost" id="overlayCancel">Batal</button>
                <button class="send" id="overlaySend">Kirim</button>
            </div>
        </div>
    </div>

    <!-- Context menu: History item -->
    <div class="ctx" id="ctxHistory">
        <div class="row" data-act="rename"><i class="fa-regular fa-pen-to-square"></i> Ganti nama</div>
        <div class="row" data-act="archive"><i class="fa-regular fa-folder"></i> Arsipkan/Pulihkan</div>
        <div class="row" data-act="delete"><i class="fa-regular fa-trash-can"></i> Hapus</div>
    </div>

    <!-- Context menu: User bubble -->
    <div class="ctx" id="ctxUser">
        <div class="row" data-act="copy"><i class="fa-regular fa-copy"></i> Salin teks</div>
        <div class="row" data-act="select"><i class="fa-regular fa-square"></i> Pilih teks</div>
        <div class="row" data-act="edit"><i class="fa-regular fa-pen-to-square"></i> Edit pesan</div>
    </div>

    <!-- Dark Modal: Rename -->
    <div class="modal-backdrop" id="modalRename">
        <div class="modal">
            <h3>Ganti Nama Chat</h3>
            <div class="desc">Masukkan nama baru untuk riwayat chat ini.</div>
            <div class="field"><input id="renameInput" placeholder="Nama baru"/></div>
            <div class="actions">
                <button class="ghost" data-close="#modalRename">Batal</button>
                <button class="primary" id="renameSave">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Dark Modal: Confirm Delete -->
    <div class="modal-backdrop" id="modalConfirm">
        <div class="modal">
            <h3>Hapus Chat?</h3>
            <div class="desc">Tindakan ini tidak bisa dibatalkan, Bosku.</div>
            <div class="actions">
                <button class="ghost" data-close="#modalConfirm">Batal</button>
                <button class="danger" id="confirmDelete">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Dark Modal: Tambah QnA -->
    <div class="modal-backdrop" id="modalQna">
        <div class="modal">
            <h3>Tambah QnA</h3>
            <div class="desc">Data disimpan lokal (browser) dan langsung dipakai AI.</div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Pertanyaan</div>
                <input id="qnaQ" placeholder="Contoh: Apa itu pakan layer?"/>
            </div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Jawaban</div>
                <textarea id="qnaA" rows="3" placeholder="Jawaban ringkas dan jelasâ€¦"></textarea>
            </div>
            <div class="actions">
                <button class="ghost" data-close="#modalQna">Batal</button>
                <button class="primary" id="qnaSave">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal: Name Prompt -->
    <div class="modal-backdrop" id="modalNamePrompt">
        <div class="modal">
            <h3>Halo! Salam Kenal ðŸ‘‹</h3>
            <div class="desc">Sebelum mulai, boleh tahu nama Anda?</div>
            <div class="field">
                <input id="nameInput" placeholder="Nama Anda"/>
            </div>
            <div class="actions">
                <button class="ghost" data-close="#modalNamePrompt">Nanti saja</button>
                <button class="primary" id="saveName">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal: Health Diagnosis -->
    <div class="modal-backdrop" id="modalHealth">
        <div class="modal">
            <h3><i class="fa-solid fa-stethoscope"></i> Diagnosis Kesehatan Ayam</h3>
            <div class="desc">Pilih gejala yang dialami ayam untuk mendapatkan diagnosis.</div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Gejala yang Diamati</div>
                <!-- Custom Multi Select -->
                <div class="custom-multiselect" data-target="symptoms">
                    <span class="placeholder">Pilih gejala</span>
                </div>
                <!-- select hidden -->
                <select id="symptoms" multiple style="display:none">
                    <option value="nafsu_makan_turun">Nafsu makan turun</option>
                    <option value="lesu">Lesu dan tidak aktif</option>
                    <option value="bulu_kusam">Bulu kusam dan berdiri</option>
                    <option value="diare">Diare (mencret)</option>
                    <option value="gangguan_pernafasan">Gangguan pernafasan</option>
                    <option value="produksi_telur_turun">Produksi telur menurun</option>
                    <option value="telur_abnormal">Telur abnormal (kerabang tipis, bentuk tidak normal)</option>
                    <option value="warna_comb_pucat">Warna comb pucat</option>
                    <option value="pembengkakan">Pembengkakan pada wajah atau persendian</option>
                    <option value="kelumpuhan">Kelumpuhan atau gangguan syaraf</option>
                </select>
            </div>
            <div class="actions">
                <button class="ghost" data-close="#modalHealth">Batal</button>
                <button class="primary" id="healthDiagnose">Diagnosis</button>
            </div>
        </div>
    </div>

    <!-- Modal: Feed Calculator -->
    <div class="modal-backdrop" id="modalFeed">
        <div class="modal">
            <h3><i class="fa-solid fa-calculator"></i> Kalkulator Pakan</h3>
            <div class="desc">Hitung kebutuhan pakan berdasarkan jumlah dan umur ayam.</div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Jumlah Ayam</div>
                <input type="number" id="feedChickenCount" placeholder="Contoh: 100" min="1"/>
            </div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Umur Ayam (minggu)</div>
                <input type="number" id="feedChickenAge" placeholder="Contoh: 20" min="1" max="100"/>
            </div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Jenis Ayam</div>
                <select id="feedChickenType">
                    <option value="layer">Layer (Petelur)</option>
                    <option value="broiler">Broiler (Pedaging)</option>
                </select>
            </div>
            <div class="actions">
                <button class="ghost" data-close="#modalFeed">Batal</button>
                <button class="primary" id="feedCalculate">Hitung</button>
            </div>
        </div>
    </div>

    <!-- Modal: Production Tracker -->
    <div class="modal-backdrop" id="modalProduction">
        <div class="modal">
            <h3><i class="fa-solid fa-chart-line"></i> Pelacak Produksi Telur</h3>
            <div class="desc">Masukkan data produksi harian untuk melihat tren.</div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Tanggal</div>
                <input type="date" id="prodDate"/>
            </div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Jumlah Telur</div>
                <input type="number" id="prodEggCount" placeholder="Contoh: 85" min="0"/>
            </div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Jumlah Ayam</div>
                <input type="number" id="prodChickenCount" placeholder="Contoh: 100" min="1"/>
            </div>
            <div class="actions">
                <button class="ghost" data-close="#modalProduction">Batal</button>
                <button class="primary" id="prodSave">Simpan Data</button>
            </div>
        </div>
    </div>

    <!-- Modal: Disease Encyclopedia -->
    <div class="modal-backdrop" id="modalDisease">
        <div class="modal">
            <h3><i class="fa-solid fa-book-medical"></i> Ensiklopedia Penyakit</h3>
            <div class="desc">Pilih penyakit untuk melihat informasi lengkap.</div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">Penyakit</div>
                <select id="diseaseSelect">
                    <option value="">-- Pilih penyakit --</option>
                    <option value="newcastle">Newcastle Disease (ND)</option>
                    <option value="gumboro">Gumboro (IBD)</option>
                    <option value="bronchitis">Bronchitis Infeksius (IB)</option>
                    <option value="coccidiosis">Coccidiosis</option>
                    <option value="marek">Marek's Disease</option>
                    <option value="avian_influenza">Avian Influenza (AI)</option>
                    <option value="fowl_pox">Fowl Pox</option>
                    <option value="crdf">Chronic Respiratory Disease (CRD)</option>
                </select>
            </div>
            <div class="actions">
                <button class="ghost" data-close="#modalDisease">Batal</button>
                <button class="primary" id="diseaseInfo">Lihat Informasi</button>
            </div>
        </div>
    </div>

    <!-- Modal: API Key Settings -->
    <div class="modal-backdrop" id="modalApiKey">
        <div class="modal">
            <h3><i class="fa-solid fa-key"></i> Pengaturan API Key DeepSeek</h3>
            <div class="api-status" id="apiStatus"></div>
            <div class="desc">Masukkan API Key DeepSeek Anda untuk mengaktifkan fitur AI canggih.</div>
            <div class="field">
                <div style="font-size:12px;color:var(--muted);margin-bottom:6px">API Key DeepSeek</div>
                <input type="password" id="apiKeyInput" placeholder="sk-xxxxxxxxxxxxxxxxxxx" autocomplete="off"/>
            </div>
            <div class="desc" style="font-size:12px;">
                Dapatkan API key di <a href="https://platform.deepseek.com/" target="_blank" style="color:var(--accent);">platform.deepseek.com</a>
            </div>
            <div class="actions">
                <button class="ghost" data-close="#modalApiKey">Batal</button>
                <button class="primary" id="apiKeySave">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>
<!-- Load JavaScript modules -->
    <script src="modules/friendly-responses.js"></script>
    <script src="modules/personality.js"></script>
    <script src="modules/context-manager.js"></script>
    <script src="modules/enhanced-diagnosis.js"></script>
    <!-- Load JavaScript -->
    <script src="app.js"></script>
</body>
</html>
